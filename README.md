[![CI-iOS](https://github.com/andrelouw/app-template/actions/workflows/ci-ios.yml/badge.svg)](https://github.com/andrelouw/app-template/actions/workflows/ci-ios.yml)
[![CI-macOS](https://github.com/andrelouw/app-template/actions/workflows/ci-macos.yml/badge.svg)](https://github.com/andrelouw/app-template/actions/workflows/ci-macos.yml)
[![Tuist badge](https://img.shields.io/badge/Powered%20by-Tuist-blue)](https://tuist.io)

# App Template
This is a basic App template to get up and running with `iOS` or `macOS` projects quickly.

To get started, clone this repository as a template and run `make`, which will [bootstrap](#bootstrap), [rename](#reanme) and [run](#run) the project.

## Commands

### Bootstrap
`make bootstrap`

The bootstrap command installs all required tools for deevelopment (see steps below for details).

Running `make bootstrap` will:
- Run the `homebrew.sh` script to install [Homebrew](#homebrew) if not already installed
- Run the `mint.sh` script to install [Mint](#mint) if not already installed
- Run the `tuist.sh` script to install [Tuist](#tuist), if not already installed
- Run the `hooks.sh` script, installing the [pre-commit](#pre-commit) and git hooks in the local git repository

### Rename
`make rename`

Runs `rename.sh` script that allows the rename of the project and bundle identifier.

### Build
`make build`

Cleans and builds the project using [Tuist](#tuist).

### Run
`make run`

Generate the project workspace and open it using [Tuist](#tuist).

### Workspace
`make workspace`

Generate the project workspace but does not open it using [Tuist](#tuist).

### Module
`make module`

Runs the `module.sh` script, that will guide you through creating a new module for this project.
Just answer all the question, and the module will be created and generated by [Tuist](#tuist).

### CI
`make ci`

Running this command will do the following:
- Install tuist if needed
- Generate with workspace using tuist
- Build the workspace using tuist
- Run all tests

There is also `make ci_macos` and `make ci_ios` to run the above commands for each platform individually.

### Test
`make test`

Runs all tests for the project, using `xcodebuild`.

`make test_ios`
Runs all the ios tests for the project, using `xcodebuild`.

`make test_macos`
Runs all the macos tests for the project, using `xcodebuild`.

### Clean
`make clean`

Cleans the project by deleting all the `*.xcodeproj` and `*.xcworkspace` files to allow a clean project generation when using [Tuist](#tuist).

### Linting and formatting
`make lint`

Runs `lint.sh` which lints all swift files using [swiftlint](#swiflint) and [swiftformat](#swiftformat) through [Mint](#mint).

`make format`

Runs `format.sh` which formats all swift files using [swiftlint](#swiflint) and [swiftformat](#swiftformat) through [Mint](#mint).

### Unisntalling
`make unbootstrap`

All the installed tools can easily be removed again by running `make unbootstrap`.

## Project Structure
At the root of the folder you will find all the config files, see the [Tools](#tools) section for more info on each config file.

The remaining folders are like follows, see each section below for more detail on each

```
.
├── Apps
├── Modules
├── Scripts
├── Tuist
└── Workspace.swift
```

### Apps
The Apps folder contains the main project file for the `iOS` app, and all future apps and app extensions will be added in this folder.

```
Apps
└── iOS
    ├── Derived
    │   └── Sources
    ├── Project.swift
    ├── iOSApp
    │   ├── Config
    │   ├── Resources
    │   └── Sources
    └── iOSAppTests
        ├── Config
        └── Tests
```

The `iOSApp` directory contains the [source files](#sources), [resources](#resources) and  [config](#config), for the `iOS` app.
The `iOSAppTests` directory contains the [test files](#tests) and test target [config](#config).
See the [Project.swift](#projectswift) and [Derived](#derived) sections for more details on the remaing conponents in the `iOS` directory.

### Modules
Modules are divided into two categories, namely `Foundation` and `Feature` modules.

- `Foundation` modules contain foundational tools that are combined to build other modules.
- `Feature` modules contain features that the user can feel and interact with. They are built by combining foundation modules, and sometimes other feature modules.

Refer to [µFeatures Architecture](https://docs.tuist.io/building-at-scale/microfeatures/) for more information on this topic.


#### Foundation
Foundation modules has a sources target and a test target. The sources target can have more or less directories depending on the type of module:

Sources Target:
- Sources - Contains the source code of the module
- Resources - Contains the resources of the module if applicable
- Config - Contains the config for the sources target

> The sources target always has the same name as the module

Tests Target:
- Tests - Contains the test code of the module
- Config - Contains the config for the test target

The example below shows the contents of the `Core` module, which doesn't have resources.

```
Modules/Foundation/Core
├── Core
│   ├── Config
│   └── Sources
├── CoreTests
│   ├── Config
│   └── Tests
└── Project.swift
```

See the [Project.swift](#projectswift) and [Derived](#derived) sections for more details on the remaing conponents in the directory.


#### Feature
Feature modules has source, test and example app targets.

Sources Target:
- Sources - Contains the source code of the module
- Resources - Contains the resources of the module. e.g. xcassets and strings.
- Config - Contains the config for the sources target

> The sources target always has the same name as the module

Tests Target:
- Tests - Contains the test code of the module
- Config - Contains the config for the test target

Example App Target:
Serves as a mini app that can be run in isolation, show casing the contents of the feature module.
The components in this target is similar to the main app target.

The example below shows the contents of the `Welcome` module, which doesn't have resources.

```
Modules/Features/Welcome
├── Derived
├── Project.swift
├── Welcome
│   ├── Config
│   ├── Resources
│   └── Sources
├── WelcomeApp
│   ├── Config
│   ├── Resources
│   └── Sources
└── WelcomeTests
    ├── Config
    └── Tests
```

### Workspace.swift
The `Workspace.swift` file serves as the manifest to generate the main workspace for the project using [Tuist](#tuist).

See [the Tuist docs](https://docs.tuist.io/manifests/workspace) for more details.

### Project.swift
The `Project.swift` file serves as the manifest to generate an Xcdoe poject using [Tuist](#tuist). Each module has it's own project file.

See [the Tuist docs](https://docs.tuist.io/manifests/project) for more details.

### Derived
When generating a project or workspace using tuist, all resources will be turned into swift code so all resources can be accessed in a type safe way. The generated files will be stored in the `Derived` folder of each project respectively.

See [the Tuist docs](https://docs.tuist.io/guides/resources#resourcesynthesizers) for more details.

## Tools
The tools used in this project are:

### Homebrew
[Homebrew](https://brew.sh) is used to install the follwiong tools
- [Mint](#mint)
- [pre-commit](#pre-commit)

The brews that will be installed when running `make bootstrap` are defined in the project's `Brewfile`.

### Tuist
This project uses [Tuist](https://tuist.io) to manage the Xcode projects and workspace.
Tuist (`tuistenv`) will be installed when running `make bootstrap` or `make tuist`.

See the [documentation](https://docs.tuist.io/tutorial/get-started) for more details.

The `.tuist-version` specifies the current version used for this project.

### Mint
[Mint](https://github.com/yonaskolb/Mint) is used as the package manager for Swift command line tools. The follwoing tools are installed and managed by `Mint`:
- [Swiftlint](#swiftlint)
- [Swiftformat](#swiftformat)

The packages that will be installed by `Mint` when running `make bootstrap` are definedin the project's `Mintfile`

### pre-commit
[Pre-commit](https://pre-commit.com) is used to manage the git hooks for this project.

The hooks that will be installed during `make bootstrap` is defined in `.pre-commit-config.yml`.

### Swiftlint
[Swiftlint](https://github.com/realm/SwiftLint) is used to lint and format all swift files in the project, in conjuction with [Swiftformat](#swiftformat).
Airbnb
All `swiftlint` rules being used are defined in `.swiftlint.yml`.

> The [Airbnb](https://github.com/airbnb/swift)'s style guide was used as a starting point

### Swiftformat
[Swiftformat](https://github.com/nicklockwood/SwiftFormat) is used to lint and format all swift files in the project, in conjuction with [Swiftlint](#swiftlint).

All `swiftformat` rules being used are defined in `.swiftformat`.

> The [Airbnb](https://github.com/airbnb/swift)'s style guide was used as a starting point

### Xcode
The `.xcode-version` defines the Xcode version that will be used durin CI runs.

### Github Actions
This project uses GitHub actions as the CI runner.
On each push to `develop` the following workflows will run:
-  [CI-iOS]().github/workflows/ci-ios.yml)
-  [CI-macOS]().github/workflows/ci-macos.yml)

### Scripts
A lot of scripts written in bash are used for setting up the project. These can be found under the `Scrips` directory.

The following commands are needed on the local machine for these scripts to run:
- `sed` - used to manipulate text files
- `awk` - in used to manipulate strings

## Caveats
- Multiplatform `Feature` modules has not been tested yet, best to keep them to one platform for now
